# Minpack Builder Windows Installer

## Summary

The goal of this repository is to provide a Windows Installer (.msi) to the [MINPACK-1](https://www.netlib.org/minpack) binaries built by our [Minpack Builder](https://github.com/luau-project/minpack-builder) project.

> [!IMPORTANT]
> 
> This project is still in early stages, but might evolve quickly, because *proof of concepts* (.msi) packages containing most expected features were worked locally.

## Table of Contents

* [How](#how)
* [Development](#development)
    * [How to insert binaries for a compiler](#how-to-insert-binaries-for-a-compiler)

## How

In order to create a MSI package (.msi) for the binaries, we use [CMake](https://cmake.org/) (&ge; 3.20) to configure the project to be consumed by the command line tools of the [WiX Toolset V5](https://wixtoolset.org/).

## Development

### How to insert binaries for a compiler

Most of the source files (.wxs, .wxi) for the ```WiX Toolset``` project are generated by ```cmake``` at the configuration step. To ease the process to add binaries built by different compilers to the MSI package, we use a json file (.json) to provide enough information to configure such binaries for the installation.

The json configuration file must hold the root element as a json array whose elements follow the format:

```json
[
    {
        "CompilerId": "GFortranUCRTSixFour",
        "CompilerName": "GFortran UCRT64 from MSYS2",
        "Version": "14.2.0",
        "HostArch": "x64"
    },
    .
    .
    .,
    {
        "CompilerId": "LLVMFlangNewMsvcLike",
        "CompilerName": "LLVM flang-new MSVC-like",
        "Version": "18.1.7",
        "HostArch": "x64"
    }
]
```

Each element of the array must provide an unique ```CompilerId``` field to identify the compiler. Moreover, other fields such as ```CompilerName```, ```Version``` and ```HostArch``` help to describe the compiler properties to the end user. For instance, the first array element above shows information for ```GFortran 14.2.0``` using the universal C runtime from MSYS2 project targeting 64-bit architecture, while the last element identifies the ```LLVM flang-new 18.1.7``` emiting MSVC ABI-compatible binaries targeting 64-bit arch.

### How to generate the WiX Toolset project

In the project directory, run

```bash
cmake -DPROJECT_SETTINGS=path/to/settings.json -S . -B build
```

If the command succeed, the source files for the ```WiX Toolset``` project will be stored at ```build/wixtoolset-v5``` directory.

> [!IMPORTANT]
> 
> At the moment, being in pre-alpha stage, the generated source files are not capable to build a working project. We are currently working on the project generation from CMake for several compiler toolchains.